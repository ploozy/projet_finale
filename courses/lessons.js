// State Management
let currentLesson = null;
let currentStep = 0;
let totalXP = parseInt(localStorage.getItem('arabicXP') || '0');
let lessonsProgress = JSON.parse(localStorage.getItem('lessonsProgress') || '{}');

// Speech Synthesis
function speakArabic(text, element) {
    window.speechSynthesis.cancel();
    const utterance = new SpeechSynthesisUtterance(text);
    utterance.lang = 'ar-SA';
    utterance.rate = 0.8;
    const voices = window.speechSynthesis.getVoices();
    const arabicVoice = voices.find(v => v.lang.startsWith('ar'));
    if (arabicVoice) utterance.voice = arabicVoice;
    if (element) {
        element.classList.add('speaking');
        utterance.onend = () => element.classList.remove('speaking');
    }
    window.speechSynthesis.speak(utterance);
}

function makeSpeakable(container) {
    const selectors = ['.arabic-word', '.vocab-arabic', '.exercise-arabic', 'span.arabic', '.grammar-box .arabic', '.warning-box .arabic'];
    selectors.forEach(selector => {
        container.querySelectorAll(selector).forEach(el => {
            if (!el.classList.contains('speakable') && el.textContent.trim()) {
                el.classList.add('speakable');
                el.title = 'Clique pour Ã©couter';
                el.addEventListener('click', e => { e.stopPropagation(); speakArabic(el.textContent.trim(), el); });
            }
        });
    });
    container.querySelectorAll('.vocab-table td').forEach(el => {
        if (/[\u0600-\u06FF]/.test(el.textContent) && !el.classList.contains('speakable')) {
            el.classList.add('speakable');
            el.title = 'Clique pour Ã©couter';
            el.addEventListener('click', e => { e.stopPropagation(); speakArabic(el.textContent.trim(), el); });
        }
    });
}

if ('speechSynthesis' in window) window.speechSynthesis.onvoiceschanged = () => window.speechSynthesis.getVoices();

document.addEventListener('DOMContentLoaded', () => { updateXPDisplay(); updateProgressBars(); });

// Lessons Data
const lessonsData = {
    1: {
        title: "Ø§Ù„Ø¯Ø±Ø³ Ø§Ù„Ø£ÙˆÙ„ - Les noms dÃ©monstratifs (Ù‡Ø°Ø§)",
        xp: 50,
        steps: [
            { type: "theory", content: `<div class="audio-hint"><span class="audio-hint-icon">ğŸ”Š</span><span>Clique sur les mots arabes pour entendre leur prononciation !</span></div><div class="theory-section"><h3 class="theory-title">ğŸ“š Introduction aux types de mots</h3><div class="theory-content"><p>En arabe, les mots (Ø§Ù„ÙƒÙÙ„ÙÙ…ÙØ©Ù) se divisent en <strong>trois catÃ©gories</strong> :</p><div class="grammar-box"><h4>ğŸ“ Les trois types de mots</h4><table class="vocab-table"><thead><tr><th>Arabe</th><th>FranÃ§ais</th><th>DÃ©finition</th></tr></thead><tbody><tr><td class="vocab-arabic arabic">Ø§ÙØ³Ù’Ù…ÙŒ</td><td>Nom</td><td>Indique un sens par lui-mÃªme</td></tr><tr><td class="vocab-arabic arabic">ÙÙØ¹Ù’Ù„ÙŒ</td><td>Verbe</td><td>Indique une action et un temps</td></tr><tr><td class="vocab-arabic arabic">Ø­ÙØ±Ù’ÙÙŒ</td><td>Particule</td><td>N'a de sens qu'avec un autre mot</td></tr></tbody></table></div></div></div>` },
            { type: "theory", content: `<div class="theory-section"><h3 class="theory-title">ğŸ“š Le dÃ©monstratif Ù‡Ø°Ø§</h3><div class="theory-content"><div class="arabic-example"><div class="arabic-word arabic">Ù‡ÙØ°ÙØ§</div><div class="arabic-translation">Ceci / Celui-ci</div></div><p><span class="arabic">Ù‡ÙØ°ÙØ§</span> est un <strong>nom dÃ©monstratif</strong> (Ø§ÙØ³Ù’Ù…Ù Ø¥Ø´ÙØ§Ø±ÙØ©Ù). Il s'utilise pour :</p><div class="grammar-box"><h4>âœ… Conditions d'utilisation</h4><ul style="list-style:none;padding:0;"><li>â€¢ <strong class="arabic">Ù…ÙÙÙ’Ø±ÙØ¯</strong> - Singulier</li><li>â€¢ <strong class="arabic">Ù…ÙØ°ÙÙƒÙÙ‘Ø±</strong> - Masculin</li><li>â€¢ <strong class="arabic">Ù‚ÙØ±ÙÙŠØ¨</strong> - Proche</li></ul></div><div class="arabic-example"><div class="arabic-word arabic">Ù‡ÙØ°ÙØ§ ÙƒÙÙ„Ù’Ø¨ÙŒ</div><div class="arabic-translation">Ceci est un chien</div></div></div></div>` },
            { type: "exercise", content: `<div class="exercise-section"><h3 class="exercise-title">ğŸ¯ Exercice pratique</h3><div class="exercise-question"><p>Comment dit-on "Ceci est un livre" en arabe ?</p></div><div class="options-grid"><button class="option-btn" data-correct="false" onclick="checkAnswer(this)"><span class="arabic">Ø°Ù„ÙÙƒÙ ÙƒÙØªÙØ§Ø¨ÙŒ</span></button><button class="option-btn" data-correct="true" onclick="checkAnswer(this)"><span class="arabic">Ù‡ÙØ°ÙØ§ ÙƒÙØªÙØ§Ø¨ÙŒ</span></button><button class="option-btn" data-correct="false" onclick="checkAnswer(this)"><span class="arabic">Ù…ÙØ§ ÙƒÙØªÙØ§Ø¨ÙŒ</span></button><button class="option-btn" data-correct="false" onclick="checkAnswer(this)"><span class="arabic">Ù…ÙÙ†Ù’ ÙƒÙØªÙØ§Ø¨ÙŒ</span></button></div><div class="feedback-message" id="feedback"></div></div>` },
            { type: "theory", content: `<div class="theory-section"><h3 class="theory-title">ğŸ“š Vocabulaire : Singulier et Pluriel</h3><div class="theory-content"><div class="warning-box"><h4>âš ï¸ ParticularitÃ© orthographique</h4><p>Le alif aprÃ¨s le Ù‡ se prononce mais ne s'Ã©crit pas :</p><div class="arabic-example"><div class="arabic-word arabic">Ù‡ÙØ°ÙØ§ = Ù‡ÙØ§Ø°ÙØ§</div></div></div><table class="vocab-table"><thead><tr><th>Singulier</th><th>Pluriel</th><th>Traduction</th></tr></thead><tbody><tr><td class="vocab-arabic arabic">ÙƒÙØªÙØ§Ø¨ÙŒ</td><td class="vocab-arabic arabic">ÙƒÙØªÙØ¨ÙŒ</td><td>Livre(s)</td></tr><tr><td class="vocab-arabic arabic">Ù…ÙØ³Ù’Ø¬ÙØ¯ÙŒ</td><td class="vocab-arabic arabic">Ù…ÙØ³ÙØ§Ø¬ÙØ¯Ù</td><td>MosquÃ©e(s)</td></tr><tr><td class="vocab-arabic arabic">Ø¨ÙÙŠÙ’ØªÙŒ</td><td class="vocab-arabic arabic">Ø¨ÙÙŠÙÙˆØªÙŒ</td><td>Maison(s)</td></tr><tr><td class="vocab-arabic arabic">Ù‚ÙÙ„ÙÙ…ÙŒ</td><td class="vocab-arabic arabic">Ø£ÙÙ‚Ù’Ù„ÙØ§Ù…ÙŒ</td><td>Stylo(s)</td></tr></tbody></table></div></div>` },
            { type: "exercise", content: `<div class="exercise-section"><h3 class="exercise-title">ğŸ¯ Exercice final</h3><div class="exercise-question"><p>Quel est le pluriel de <span class="arabic" style="font-size:1.5rem;color:var(--primary);">Ø¨ÙØ§Ø¨ÙŒ</span> (porte) ?</p></div><div class="options-grid"><button class="option-btn" data-correct="false" onclick="checkAnswer(this)"><span class="arabic">Ø¨ÙÙŠÙÙˆØªÙŒ</span></button><button class="option-btn" data-correct="true" onclick="checkAnswer(this)"><span class="arabic">Ø£ÙØ¨Ù’ÙˆÙØ§Ø¨ÙŒ</span></button><button class="option-btn" data-correct="false" onclick="checkAnswer(this)"><span class="arabic">ÙƒÙØªÙØ¨ÙŒ</span></button><button class="option-btn" data-correct="false" onclick="checkAnswer(this)"><span class="arabic">Ù…ÙÙÙØ§ØªÙØ­Ù</span></button></div><div class="feedback-message" id="feedback"></div></div>` }
        ]
    },
    2: {
        title: "Ø§Ù„Ø¯Ø±Ø³ Ø§Ù„Ø«Ø§Ù†ÙŠ - L'interrogatif",
        xp: 60,
        steps: [
            { type: "theory", content: `<div class="audio-hint"><span class="audio-hint-icon">ğŸ”Š</span><span>Clique sur les mots arabes pour entendre leur prononciation !</span></div><div class="theory-section"><h3 class="theory-title">ğŸ“š L'interrogatif (Ø§Ù„Ø§ÙØ³Ù’ØªÙÙÙ’Ù‡ÙØ§Ù…Ù)</h3><div class="theory-content"><p>Pour poser des questions en arabe :</p><div class="grammar-box"><h4>ğŸ“ Les particules et noms interrogatifs</h4><table class="vocab-table"><thead><tr><th>Arabe</th><th>Type</th><th>Traduction</th></tr></thead><tbody><tr><td class="vocab-arabic arabic">Ø£Ù</td><td>Particule</td><td>Est-ce que ?</td></tr><tr><td class="vocab-arabic arabic">Ù…ÙØ§</td><td>Nom</td><td>Qu'est-ce que ?</td></tr><tr><td class="vocab-arabic arabic">Ù…ÙÙ†Ù’</td><td>Nom</td><td>Qui est-ce ?</td></tr></tbody></table></div></div></div>` },
            { type: "theory", content: `<div class="theory-section"><h3 class="theory-title">ğŸ“š La hamza interrogative (Ø£Ù)</h3><div class="theory-content"><div class="arabic-example"><div class="arabic-word arabic">Ø£Ù</div><div class="arabic-translation">Est-ce que ?</div></div><div class="grammar-box"><h4>âœ… Comment rÃ©pondre ?</h4><ul style="list-style:none;padding:0;"><li>â€¢ <span class="arabic" style="color:var(--success);font-size:1.3rem;">Ù†ÙØ¹ÙÙ…Ù’</span> - Oui</li><li>â€¢ <span class="arabic" style="color:var(--accent);font-size:1.3rem;">Ù„ÙØ§</span> - Non</li></ul></div><div class="arabic-example"><div class="arabic-word arabic">Ø£ÙÙ‡ÙØ°ÙØ§ ÙƒÙØªÙØ§Ø¨ÙŒØŸ</div><div class="arabic-translation">Est-ce que ceci est un livre ?</div></div></div></div>` },
            { type: "exercise", content: `<div class="exercise-section"><h3 class="exercise-title">ğŸ¯ Exercice pratique</h3><div class="exercise-question"><p class="arabic" style="font-size:2rem;color:var(--primary);">Ø£ÙÙ‡ÙØ°ÙØ§ Ø¨ÙÙŠÙ’ØªÙŒØŸ</p><p>(En regardant une mosquÃ©e)</p></div><div class="options-grid"><button class="option-btn" data-correct="true" onclick="checkAnswer(this)"><span class="arabic">Ù„ÙØ§ØŒ Ù‡ÙØ°ÙØ§ Ù…ÙØ³Ù’Ø¬ÙØ¯ÙŒ</span></button><button class="option-btn" data-correct="false" onclick="checkAnswer(this)"><span class="arabic">Ù†ÙØ¹ÙÙ…Ù’ØŒ Ù‡ÙØ°ÙØ§ Ø¨ÙÙŠÙ’ØªÙŒ</span></button><button class="option-btn" data-correct="false" onclick="checkAnswer(this)"><span class="arabic">Ù…ÙØ§ Ù‡ÙØ°ÙØ§</span></button><button class="option-btn" data-correct="false" onclick="checkAnswer(this)"><span class="arabic">Ù…ÙÙ†Ù’ Ù‡ÙØ°ÙØ§</span></button></div><div class="feedback-message" id="feedback"></div></div>` },
            { type: "theory", content: `<div class="theory-section"><h3 class="theory-title">ğŸ“š Ù…ÙØ§ vs Ù…ÙÙ†Ù’</h3><div class="theory-content"><div class="grammar-box"><h4>ğŸ”‘ DiffÃ©rence clÃ©</h4><table class="vocab-table"><thead><tr><th>Interrogatif</th><th>Utilisation</th><th>Exemple</th></tr></thead><tbody><tr><td class="vocab-arabic arabic">Ù…ÙØ§</td><td>Non-humain</td><td class="vocab-arabic arabic">Ù…ÙØ§ Ù‡ÙØ°ÙØ§ØŸ Ù‡ÙØ°ÙØ§ ÙƒÙÙ„Ù’Ø¨ÙŒ</td></tr><tr><td class="vocab-arabic arabic">Ù…ÙÙ†Ù’</td><td>Humain</td><td class="vocab-arabic arabic">Ù…ÙÙ†Ù’ Ù‡ÙØ°ÙØ§ØŸ Ù‡ÙØ°ÙØ§ Ø·ÙØ¨ÙÙŠØ¨ÙŒ</td></tr></tbody></table></div></div></div>` },
            { type: "exercise", content: `<div class="exercise-section"><h3 class="exercise-title">ğŸ¯ Exercice pratique</h3><div class="exercise-question"><p>Pour demander "Qui est cet enseignant ?", j'utilise :</p></div><div class="options-grid"><button class="option-btn" data-correct="false" onclick="checkAnswer(this)"><span class="arabic">Ù…ÙØ§ Ù‡ÙØ°ÙØ§ Ø§Ù„Ù…ÙØ¯ÙØ±ÙÙ‘Ø³ÙØŸ</span></button><button class="option-btn" data-correct="true" onclick="checkAnswer(this)"><span class="arabic">Ù…ÙÙ†Ù’ Ù‡ÙØ°ÙØ§ Ø§Ù„Ù…ÙØ¯ÙØ±ÙÙ‘Ø³ÙØŸ</span></button><button class="option-btn" data-correct="false" onclick="checkAnswer(this)"><span class="arabic">Ø£ÙÙ‡ÙØ°ÙØ§ Ù…ÙØ¯ÙØ±ÙÙ‘Ø³ÙŒØŸ</span></button><button class="option-btn" data-correct="false" onclick="checkAnswer(this)"><span class="arabic">Ù‡ÙØ°ÙØ§ Ù…ÙØ¯ÙØ±ÙÙ‘Ø³ÙŒ</span></button></div><div class="feedback-message" id="feedback"></div></div>` },
            { type: "theory", content: `<div class="theory-section"><h3 class="theory-title">ğŸ“š Vocabulaire</h3><div class="theory-content"><table class="vocab-table"><thead><tr><th>Singulier</th><th>Pluriel</th><th>Traduction</th></tr></thead><tbody><tr><td class="vocab-arabic arabic">Ø·ÙØ¨ÙÙŠØ¨ÙŒ</td><td class="vocab-arabic arabic">Ø£ÙØ·ÙØ¨ÙÙ‘Ø§Ø¡Ù</td><td>MÃ©decin(s)</td></tr><tr><td class="vocab-arabic arabic">Ù…ÙØ¯ÙØ±ÙÙ‘Ø³ÙŒ</td><td class="vocab-arabic arabic">Ù…ÙØ¯ÙØ±ÙÙ‘Ø³ÙÙˆÙ†Ù</td><td>Enseignant(s)</td></tr><tr><td class="vocab-arabic arabic">Ø·ÙØ§Ù„ÙØ¨ÙŒ</td><td class="vocab-arabic arabic">Ø·ÙÙ„ÙÙ‘Ø§Ø¨ÙŒ</td><td>Ã‰tudiant(s)</td></tr><tr><td class="vocab-arabic arabic">ÙƒÙÙ„Ù’Ø¨ÙŒ</td><td class="vocab-arabic arabic">ÙƒÙÙ„ÙØ§Ø¨ÙŒ</td><td>Chien(s)</td></tr></tbody></table></div></div>` }
        ]
    },
    3: {
        title: "Ø§Ù„Ø¯Ø±Ø³ Ø§Ù„Ø«Ø§Ù„Ø« - Le dÃ©monstratif Ã©loignÃ© (Ø°Ù„Ùƒ)",
        xp: 50,
        steps: [
            { type: "theory", content: `<div class="audio-hint"><span class="audio-hint-icon">ğŸ”Š</span><span>Clique sur les mots arabes pour entendre leur prononciation !</span></div><div class="theory-section"><h3 class="theory-title">ğŸ“š Le dÃ©monstratif Ø°ÙÙ„ÙÙƒÙ</h3><div class="theory-content"><div class="arabic-example"><div class="arabic-word arabic">Ø°ÙÙ„ÙÙƒÙ</div><div class="arabic-translation">Cela / Celui-lÃ </div></div><p><span class="arabic">Ø°ÙÙ„ÙÙƒÙ</span> s'utilise pour dÃ©signer quelque chose qui est :</p><div class="grammar-box"><h4>âœ… Conditions d'utilisation</h4><ul style="list-style:none;padding:0;"><li>â€¢ <strong class="arabic">Ù…ÙÙÙ’Ø±ÙØ¯</strong> - Singulier</li><li>â€¢ <strong class="arabic">Ù…ÙØ°ÙÙƒÙÙ‘Ø±</strong> - Masculin</li><li>â€¢ <strong class="arabic" style="color:var(--accent);">Ø¨ÙØ¹ÙÙŠØ¯</strong> - <strong>Ã‰loignÃ©</strong></li></ul></div><div class="arabic-example"><div class="arabic-word arabic">Ø°ÙÙ„ÙÙƒÙ Ù†ÙØ¬Ù’Ù…ÙŒ</div><div class="arabic-translation">Cela est une Ã©toile (loin)</div></div></div></div>` },
            { type: "theory", content: `<div class="theory-section"><h3 class="theory-title">ğŸ“š DiffÃ©rence entre Ù‡ÙØ°ÙØ§ et Ø°ÙÙ„ÙÙƒÙ</h3><div class="theory-content"><div class="grammar-box"><h4>ğŸ”‘ La seule diffÃ©rence : la distance</h4><table class="vocab-table"><thead><tr><th>DÃ©monstratif</th><th>Distance</th><th>Exemple</th></tr></thead><tbody><tr><td class="vocab-arabic arabic" style="color:var(--success);">Ù‡ÙØ°ÙØ§</td><td style="color:var(--success);">Proche</td><td class="vocab-arabic arabic">Ù‡ÙØ°ÙØ§ Ù…ÙØ³Ù’Ø¬ÙØ¯ÙŒ</td></tr><tr><td class="vocab-arabic arabic" style="color:var(--accent);">Ø°ÙÙ„ÙÙƒÙ</td><td style="color:var(--accent);">Ã‰loignÃ©</td><td class="vocab-arabic arabic">Ø°ÙÙ„ÙÙƒÙ Ø¨ÙÙŠÙ’ØªÙŒ</td></tr></tbody></table></div></div></div>` },
            { type: "exercise", content: `<div class="exercise-section"><h3 class="exercise-title">ğŸ¯ Exercice pratique</h3><div class="exercise-question"><p>Tu vois une Ã©toile dans le ciel (loin). Comment dis-tu "Cela est une Ã©toile" ?</p></div><div class="options-grid"><button class="option-btn" data-correct="false" onclick="checkAnswer(this)"><span class="arabic">Ù‡ÙØ°ÙØ§ Ù†ÙØ¬Ù’Ù…ÙŒ</span></button><button class="option-btn" data-correct="true" onclick="checkAnswer(this)"><span class="arabic">Ø°ÙÙ„ÙÙƒÙ Ù†ÙØ¬Ù’Ù…ÙŒ</span></button><button class="option-btn" data-correct="false" onclick="checkAnswer(this)"><span class="arabic">Ù…ÙØ§ Ù†ÙØ¬Ù’Ù…ÙŒ</span></button><button class="option-btn" data-correct="false" onclick="checkAnswer(this)"><span class="arabic">Ù…ÙÙ†Ù’ Ù†ÙØ¬Ù’Ù…ÙŒ</span></button></div><div class="feedback-message" id="feedback"></div></div>` },
            { type: "theory", content: `<div class="theory-section"><h3 class="theory-title">ğŸ“š Vocabulaire supplÃ©mentaire</h3><div class="theory-content"><table class="vocab-table"><thead><tr><th>Singulier</th><th>Pluriel</th><th>Traduction</th></tr></thead><tbody><tr><td class="vocab-arabic arabic">Ø¥ÙÙ…ÙØ§Ù…ÙŒ</td><td class="vocab-arabic arabic">Ø£ÙØ¦ÙÙ…ÙÙ‘Ø©ÙŒ</td><td>Imam(s)</td></tr><tr><td class="vocab-arabic arabic">Ø³ÙÙƒÙÙ‘Ø±ÙŒ</td><td class="vocab-arabic arabic">-</td><td>Sucre</td></tr><tr><td class="vocab-arabic arabic">Ø­ÙØ¬ÙØ±ÙŒ</td><td class="vocab-arabic arabic">Ø­ÙØ¬ÙØ§Ø±ÙŒ</td><td>Pierre(s)</td></tr><tr><td class="vocab-arabic arabic">Ù„ÙØ¨ÙÙ†ÙŒ</td><td class="vocab-arabic arabic">Ø£ÙÙ„Ù’Ø¨ÙØ§Ù†ÙŒ</td><td>Lait(s)</td></tr></tbody></table></div></div>` },
            { type: "exercise", content: `<div class="exercise-section"><h3 class="exercise-title">ğŸ¯ Exercice final</h3><div class="exercise-question"><p>"Ceci est du sucre (proche) et cela est du lait (loin)"</p></div><div class="options-grid"><button class="option-btn" data-correct="true" onclick="checkAnswer(this)"><span class="arabic">Ù‡ÙØ°ÙØ§ Ø³ÙÙƒÙÙ‘Ø±ÙŒ ÙˆÙØ°ÙÙ„ÙÙƒÙ Ù„ÙØ¨ÙÙ†ÙŒ</span></button><button class="option-btn" data-correct="false" onclick="checkAnswer(this)"><span class="arabic">Ø°ÙÙ„ÙÙƒÙ Ø³ÙÙƒÙÙ‘Ø±ÙŒ ÙˆÙÙ‡ÙØ°ÙØ§ Ù„ÙØ¨ÙÙ†ÙŒ</span></button><button class="option-btn" data-correct="false" onclick="checkAnswer(this)"><span class="arabic">Ù‡ÙØ°ÙØ§ Ø³ÙÙƒÙÙ‘Ø±ÙŒ ÙˆÙÙ‡ÙØ°ÙØ§ Ù„ÙØ¨ÙÙ†ÙŒ</span></button><button class="option-btn" data-correct="false" onclick="checkAnswer(this)"><span class="arabic">Ø°ÙÙ„ÙÙƒÙ Ø³ÙÙƒÙÙ‘Ø±ÙŒ ÙˆÙØ°ÙÙ„ÙÙƒÙ Ù„ÙØ¨ÙÙ†ÙŒ</span></button></div><div class="feedback-message" id="feedback"></div></div>` }
        ]
    },
    4: {
        title: "Ø§Ù„Ø¯Ø±Ø³ Ø§Ù„Ø±Ø§Ø¨Ø¹ - Le dÃ©fini et l'indÃ©fini",
        xp: 70,
        steps: [
            { type: "theory", content: `<div class="audio-hint"><span class="audio-hint-icon">ğŸ”Š</span><span>Clique sur les mots arabes pour entendre leur prononciation !</span></div><div class="theory-section"><h3 class="theory-title">ğŸ“š L'indÃ©fini et le dÃ©fini</h3><div class="theory-content"><div class="grammar-box"><h4>ğŸ“ L'indÃ©fini (Ø§Ù„Ù†ÙÙ‘ÙƒÙØ±ÙØ©)</h4><ul style="list-style:none;padding:0;"><li>â€¢ Base du nom</li><li>â€¢ Non dÃ©signÃ©</li><li>â€¢ Tanwin (ÙŒ Ù‹ Ù)</li></ul></div><div class="warning-box"><h4>âš ï¸ Le dÃ©fini (Ø§Ù„Ù…ÙØ¹Ù’Ø±ÙÙÙØ©)</h4><ul style="list-style:none;padding:0;"><li>â€¢ DÃ©terminÃ©</li><li>â€¢ Article <span class="arabic" style="color:var(--primary);">Ø§Ù„</span></li><li>â€¢ Perd le tanwin</li></ul></div><div class="arabic-example"><div class="arabic-word arabic">ÙƒÙØªÙØ§Ø¨ÙŒ â†’ Ø§Ù„ÙƒÙØªÙØ§Ø¨Ù</div><div class="arabic-translation">un livre â†’ le livre</div></div></div></div>` },
            { type: "theory", content: `<div class="theory-section"><h3 class="theory-title">ğŸ“š L'article dÃ©fini (Ø§Ù„)</h3><div class="theory-content"><p>L'article <span class="arabic" style="font-size:1.5em;color:var(--primary);">Ø§Ù„</span> = Ø§ (hamza de liaison) + Ù„</p><div class="warning-box"><h4>âš ï¸ Important</h4><p>La hamza de liaison ne se prononce qu'en <strong>dÃ©but de phrase</strong> !</p><div class="arabic-example"><p class="arabic" style="font-size:1.3rem;">Ø§ÙÙ„Ù’ÙƒÙØªÙØ§Ø¨Ù Ø¬ÙØ¯ÙÙŠØ¯ÙŒ</p><p class="arabic-translation">Le livre est nouveau (dÃ©but)</p><p class="arabic" style="font-size:1.3rem;margin-top:0.5rem;">Ù‡ÙØ°ÙØ§ Ø§Ù„Ù’ÙƒÙØªÙØ§Ø¨Ù</p><p class="arabic-translation">Ce livre (milieu - hamza non prononcÃ©e)</p></div></div></div></div>` },
            { type: "theory", content: `<div class="theory-section"><h3 class="theory-title">ğŸ“š Les lettres lunaires ğŸŒ™</h3><div class="theory-content"><p>Devant ces lettres, le <strong>Ù„Ø§Ù… se prononce</strong> :</p><div class="grammar-box"><h4>ğŸ“ Les 14 lettres lunaires</h4><p class="arabic" style="font-size:1.5rem;text-align:center;">Ø£ Ø¨ Ø¬ Ø­ Ø® Ø¹ Øº Ù Ù‚ Ùƒ Ù… Ùˆ Ù‡Ù€ ÙŠ</p></div><table class="vocab-table"><thead><tr><th>Lettre</th><th>Exemple</th><th>Prononciation</th></tr></thead><tbody><tr><td class="vocab-arabic arabic">Ø¨</td><td class="vocab-arabic arabic">Ø§Ù„Ø¨ÙØ§Ø¨Ù</td><td>al-bÄb</td></tr><tr><td class="vocab-arabic arabic">Ùƒ</td><td class="vocab-arabic arabic">Ø§Ù„ÙƒÙØªÙØ§Ø¨Ù</td><td>al-kitÄb</td></tr><tr><td class="vocab-arabic arabic">Ù‚</td><td class="vocab-arabic arabic">Ø§Ù„Ù‚ÙÙ…ÙØ±Ù</td><td>al-qamar</td></tr></tbody></table></div></div>` },
            { type: "theory", content: `<div class="theory-section"><h3 class="theory-title">ğŸ“š Les lettres solaires â˜€ï¸</h3><div class="theory-content"><p>Devant ces lettres, le <strong>Ù„Ø§Ù… NE se prononce PAS</strong> (lettre doublÃ©e) :</p><div class="warning-box"><h4>âš ï¸ Les 14 lettres solaires</h4><p class="arabic" style="font-size:1.5rem;text-align:center;">Øª Ø« Ø¯ Ø° Ø± Ø² Ø³ Ø´ Øµ Ø¶ Ø· Ø¸ Ù„ Ù†</p></div><table class="vocab-table"><thead><tr><th>Lettre</th><th>Exemple</th><th>Prononciation</th></tr></thead><tbody><tr><td class="vocab-arabic arabic">Ø´</td><td class="vocab-arabic arabic">Ø§Ù„Ø´ÙÙ‘Ù…Ù’Ø³Ù</td><td>ash-shams</td></tr><tr><td class="vocab-arabic arabic">Ø±</td><td class="vocab-arabic arabic">Ø§Ù„Ø±ÙÙ‘Ø¬ÙÙ„Ù</td><td>ar-rajul</td></tr><tr><td class="vocab-arabic arabic">Ù†</td><td class="vocab-arabic arabic">Ø§Ù„Ù†ÙÙ‘Ø¬Ù’Ù…Ù</td><td>an-najm</td></tr></tbody></table></div></div>` },
            { type: "exercise", content: `<div class="exercise-section"><h3 class="exercise-title">ğŸ¯ Exercice pratique</h3><div class="exercise-question"><p>Dans <span class="arabic" style="font-size:1.5em;">Ø§Ù„Ø´ÙÙ‘Ù…Ù’Ø³Ù</span>, le Ù„Ø§Ù… se prononce-t-il ?</p></div><div class="options-grid"><button class="option-btn" data-correct="false" onclick="checkAnswer(this)">Oui, car Ø´ est lunaire</button><button class="option-btn" data-correct="true" onclick="checkAnswer(this)">Non, car Ø´ est solaire</button><button class="option-btn" data-correct="false" onclick="checkAnswer(this)">Oui, toujours</button><button class="option-btn" data-correct="false" onclick="checkAnswer(this)">Non, jamais</button></div><div class="feedback-message" id="feedback"></div></div>` },
            { type: "theory", content: `<div class="theory-section"><h3 class="theory-title">ğŸ“š Vocabulaire nouveau</h3><div class="theory-content"><table class="vocab-table"><thead><tr><th>Singulier</th><th>Pluriel</th><th>Traduction</th></tr></thead><tbody><tr><td class="vocab-arabic arabic">Ù…ÙØ§Ø¡ÙŒ</td><td class="vocab-arabic arabic">Ù…ÙÙŠÙØ§Ù‡ÙŒ</td><td>Eau</td></tr><tr><td class="vocab-arabic arabic">Ø¬ÙØ¯ÙÙŠØ¯ÙŒ</td><td class="vocab-arabic arabic">Ø¬ÙØ¯ÙØ¯ÙŒ</td><td>Nouveau</td></tr><tr><td class="vocab-arabic arabic">Ù…ÙÙÙ’ØªÙÙˆØ­ÙŒ</td><td>-</td><td>Ouvert</td></tr><tr><td class="vocab-arabic arabic">Ø´ÙÙ…Ù’Ø³ÙŒ</td><td class="vocab-arabic arabic">Ø´ÙÙ…ÙÙˆØ³ÙŒ</td><td>Soleil</td></tr><tr><td class="vocab-arabic arabic">Ù‚ÙÙ…ÙØ±ÙŒ</td><td class="vocab-arabic arabic">Ø£ÙÙ‚Ù’Ù…ÙØ§Ø±ÙŒ</td><td>Lune</td></tr></tbody></table></div></div>` },
            { type: "exercise", content: `<div class="exercise-section"><h3 class="exercise-title">ğŸ¯ Exercice final</h3><div class="exercise-question"><p>"Le livre est nouveau et la porte est ouverte"</p></div><div class="options-grid"><button class="option-btn" data-correct="true" onclick="checkAnswer(this)"><span class="arabic">Ø§Ù„ÙƒÙØªÙØ§Ø¨Ù Ø¬ÙØ¯ÙÙŠØ¯ÙŒ ÙˆÙØ§Ù„Ø¨ÙØ§Ø¨Ù Ù…ÙÙÙ’ØªÙÙˆØ­ÙŒ</span></button><button class="option-btn" data-correct="false" onclick="checkAnswer(this)"><span class="arabic">ÙƒÙØªÙØ§Ø¨ÙŒ Ø¬ÙØ¯ÙÙŠØ¯ÙŒ ÙˆÙØ¨ÙØ§Ø¨ÙŒ Ù…ÙÙÙ’ØªÙÙˆØ­ÙŒ</span></button><button class="option-btn" data-correct="false" onclick="checkAnswer(this)"><span class="arabic">Ù‡ÙØ°ÙØ§ ÙƒÙØªÙØ§Ø¨ÙŒ ÙˆÙÙ‡ÙØ°ÙØ§ Ø¨ÙØ§Ø¨ÙŒ</span></button><button class="option-btn" data-correct="false" onclick="checkAnswer(this)"><span class="arabic">Ø§Ù„ÙƒÙØªÙØ§Ø¨Ù Ù…ÙÙÙ’ØªÙÙˆØ­ÙŒ ÙˆÙØ§Ù„Ø¨ÙØ§Ø¨Ù Ø¬ÙØ¯ÙÙŠØ¯ÙŒ</span></button></div><div class="feedback-message" id="feedback"></div></div>` }
        ]
    },
    5: {
        title: "Ø§Ù„Ø¯Ø±Ø³ Ø§Ù„Ø®Ø§Ù…Ø³ - Les prÃ©positions (Ø­ÙØ±ÙÙˆÙÙ Ø§Ù„Ø¬ÙØ±ÙÙ‘)",
        xp: 60,
        steps: [
            { type: "theory", content: `<div class="audio-hint"><span class="audio-hint-icon">ğŸ”Š</span><span>Clique sur les mots arabes pour entendre leur prononciation !</span></div><div class="theory-section"><h3 class="theory-title">ğŸ“š Introduction : Ø§Ù„Ø¥ÙØ¹Ù’Ø±ÙØ§Ø¨Ù (la flexion)</h3><div class="theory-content"><p>En arabe, les terminaisons des mots peuvent <strong>varier</strong>. Cette variation s'appelle <span class="arabic" style="color:var(--primary);font-size:1.3em;">Ø§Ù„Ø¥ÙØ¹Ù’Ø±ÙØ§Ø¨Ù</span>.</p><div class="arabic-example"><p class="arabic" style="font-size:1.5rem;">Ù‡ÙØ°ÙØ§ ÙƒÙØªÙØ§Ø¨ÙŒ</p><p class="arabic-translation">Ceci est un livre (nominatif : ÙŒ)</p><p class="arabic" style="font-size:1.5rem;margin-top:0.5rem;">Ù‚ÙØ±ÙØ£Ù’ØªÙ ÙƒÙØªÙØ§Ø¨Ù‹Ø§</p><p class="arabic-translation">J'ai lu un livre (accusatif : Ù‹)</p><p class="arabic" style="font-size:1.5rem;margin-top:0.5rem;">Ù‡ÙØ°ÙØ§ ÙÙÙŠ Ø§Ù„ÙƒÙØªÙØ§Ø¨Ù</p><p class="arabic-translation">Ceci est dans le livre (gÃ©nitif : Ù)</p></div></div></div>` },
            { type: "theory", content: `<div class="theory-section"><h3 class="theory-title">ğŸ“š Les prÃ©positions (Ø­ÙØ±ÙÙˆÙÙ Ø§Ù„Ø¬ÙØ±ÙÙ‘)</h3><div class="theory-content"><div class="arabic-example"><div class="arabic-word arabic">Ø­ÙØ±ÙÙˆÙÙ Ø§Ù„Ø¬ÙØ±ÙÙ‘</div><div class="arabic-translation">Les prÃ©positions</div></div><div class="grammar-box"><h4>ğŸ“ Le rÃ´le de la prÃ©position</h4><ul style="list-style:none;padding:0;"><li>â€¢ Elle agit sur le <strong>sens</strong> d'un nom qui la suit</li><li>â€¢ Elle agit sur la <strong>voyelle finale</strong></li><li>â€¢ Le nom devient <strong>Ù…ÙØ¬Ù’Ø±ÙÙˆØ±</strong> (gÃ©nitif) avec une <span class="arabic" style="color:var(--primary);">ÙƒÙØ³Ù’Ø±ÙØ©</span> (Ù)</li></ul></div><div class="arabic-example"><div class="arabic-word arabic">Ø§Ù„ÙƒÙØªÙØ§Ø¨Ù : ÙÙÙŠ + Ø§Ù„ÙƒÙØªÙØ§Ø¨Ù = ÙÙÙŠ Ø§Ù„ÙƒÙØªÙØ§Ø¨Ù</div><div class="arabic-translation">Le livre + ÙÙŠ = dans le livre (Ù â†’ Ù)</div></div></div></div>` },
            { type: "theory", content: `<div class="theory-section"><h3 class="theory-title">ğŸ“š Les principales prÃ©positions</h3><div class="theory-content"><table class="vocab-table"><thead><tr><th>PrÃ©position</th><th>Sens</th><th>Exemple</th><th>Traduction</th></tr></thead><tbody><tr><td class="vocab-arabic arabic" style="font-size:2rem;">ÙÙÙŠ</td><td>Dans (lieu/temps)</td><td class="vocab-arabic arabic">ÙÙÙŠ Ø§Ù„Ø¨ÙÙŠÙ’ØªÙ</td><td>Dans la maison</td></tr><tr><td class="vocab-arabic arabic" style="font-size:2rem;">Ø¹ÙÙ„ÙÙ‰</td><td>Sur</td><td class="vocab-arabic arabic">Ø¹ÙÙ„ÙÙ‰ Ø§Ù„Ø·ÙÙ‘Ø§ÙˆÙÙ„ÙØ©Ù</td><td>Sur la table</td></tr><tr><td class="vocab-arabic arabic" style="font-size:2rem;">Ù…ÙÙ†Ù’</td><td>De (provenance)</td><td class="vocab-arabic arabic">Ù…ÙÙ†Ù Ø§Ù„Ù…ÙØ³Ù’Ø¬ÙØ¯Ù</td><td>De la mosquÃ©e</td></tr><tr><td class="vocab-arabic arabic" style="font-size:2rem;">Ø¥ÙÙ„ÙÙ‰</td><td>Vers</td><td class="vocab-arabic arabic">Ø¥ÙÙ„ÙÙ‰ Ø§Ù„Ù…ÙØ³Ù’Ø¬ÙØ¯Ù</td><td>Vers la mosquÃ©e</td></tr></tbody></table></div></div>` },
            { type: "exercise", content: `<div class="exercise-section"><h3 class="exercise-title">ğŸ¯ Exercice pratique</h3><div class="exercise-question"><p>Comment dit-on "dans la maison" ?</p></div><div class="options-grid"><button class="option-btn" data-correct="true" onclick="checkAnswer(this)"><span class="arabic">ÙÙÙŠ Ø§Ù„Ø¨ÙÙŠÙ’ØªÙ</span></button><button class="option-btn" data-correct="false" onclick="checkAnswer(this)"><span class="arabic">ÙÙÙŠ Ø§Ù„Ø¨ÙÙŠÙ’ØªÙ</span></button><button class="option-btn" data-correct="false" onclick="checkAnswer(this)"><span class="arabic">Ø¹ÙÙ„ÙÙ‰ Ø§Ù„Ø¨ÙÙŠÙ’ØªÙ</span></button><button class="option-btn" data-correct="false" onclick="checkAnswer(this)"><span class="arabic">Ù…ÙÙ†Ù Ø§Ù„Ø¨ÙÙŠÙ’ØªÙ</span></button></div><div class="feedback-message" id="feedback"></div></div>` },
            { type: "theory", content: `<div class="theory-section"><h3 class="theory-title">ğŸ“š Ø£ÙÙŠÙ’Ù†Ù - OÃ¹ ?</h3><div class="theory-content"><div class="arabic-example"><div class="arabic-word arabic">Ø£ÙÙŠÙ’Ù†Ù</div><div class="arabic-translation">OÃ¹ ? (OÃ¹ est-ce ?)</div></div><div class="grammar-box"><h4>ğŸ“ CaractÃ©ristiques de Ø£ÙÙŠÙ’Ù†Ù</h4><p><span class="arabic">Ø£ÙÙŠÙ’Ù†Ù</span> est un <strong>nom interrogatif</strong> (Ø§ÙØ³Ù’Ù…Ù Ø§Ø³Ù’ØªÙÙÙ’Ù‡ÙØ§Ù…Ù) exclusif pour les <strong>lieux</strong>.</p></div><div class="arabic-example"><p class="arabic" style="font-size:1.5rem;">Ø£ÙÙŠÙ’Ù†Ù Ø§Ù„ÙƒÙØªÙØ§Ø¨ÙØŸ</p><p class="arabic-translation">OÃ¹ est le livre ?</p><p class="arabic" style="font-size:1.5rem;margin-top:0.5rem;">Ù‡ÙÙˆÙ Ø¹ÙÙ„ÙÙ‰ Ø§Ù„Ù…ÙÙƒÙ’ØªÙØ¨Ù</p><p class="arabic-translation">Il est sur le bureau</p></div><div class="arabic-example" style="margin-top:1rem;"><p class="arabic" style="font-size:1.5rem;">Ø£ÙÙŠÙ’Ù†Ù Ù…ÙØ­ÙÙ…ÙÙ‘Ø¯ÙŒØŸ</p><p class="arabic-translation">OÃ¹ est Mohammed ?</p><p class="arabic" style="font-size:1.5rem;margin-top:0.5rem;">Ù‡ÙÙˆÙ ÙÙÙŠ Ø§Ù„ØºÙØ±Ù’ÙÙØ©Ù</p><p class="arabic-translation">Il est dans la chambre</p></div></div></div>` },
            { type: "theory", content: `<div class="theory-section"><h3 class="theory-title">ğŸ“š Vocabulaire : Les lieux de la maison</h3><div class="theory-content"><table class="vocab-table"><thead><tr><th>Arabe</th><th>Traduction</th><th>Exemple</th></tr></thead><tbody><tr><td class="vocab-arabic arabic">Ø§Ù„ØºÙØ±Ù’ÙÙØ©Ù</td><td>La chambre</td><td class="vocab-arabic arabic">ÙÙÙŠ Ø§Ù„ØºÙØ±Ù’ÙÙØ©Ù</td></tr><tr><td class="vocab-arabic arabic">Ø§Ù„Ø­ÙÙ…ÙÙ‘Ø§Ù…Ù</td><td>La salle de bain</td><td class="vocab-arabic arabic">ÙÙÙŠ Ø§Ù„Ø­ÙÙ…ÙÙ‘Ø§Ù…Ù</td></tr><tr><td class="vocab-arabic arabic">Ø§Ù„Ù…ÙØ·Ù’Ø¨ÙØ®Ù</td><td>La cuisine</td><td class="vocab-arabic arabic">ÙÙÙŠ Ø§Ù„Ù…ÙØ·Ù’Ø¨ÙØ®Ù</td></tr><tr><td class="vocab-arabic arabic">Ø§Ù„Ù…ÙÙƒÙ’ØªÙØ¨Ù</td><td>Le bureau</td><td class="vocab-arabic arabic">Ø¹ÙÙ„ÙÙ‰ Ø§Ù„Ù…ÙÙƒÙ’ØªÙØ¨Ù</td></tr><tr><td class="vocab-arabic arabic">Ø§Ù„Ø³ÙÙ‘Ø±ÙÙŠØ±Ù</td><td>Le lit</td><td class="vocab-arabic arabic">Ø¹ÙÙ„ÙÙ‰ Ø§Ù„Ø³ÙÙ‘Ø±ÙÙŠØ±Ù</td></tr><tr><td class="vocab-arabic arabic">Ø§Ù„ÙƒÙØ±Ù’Ø³ÙÙŠÙÙ‘</td><td>La chaise</td><td class="vocab-arabic arabic">Ø¹ÙÙ„ÙÙ‰ Ø§Ù„ÙƒÙØ±Ù’Ø³ÙÙŠÙÙ‘</td></tr><tr><td class="vocab-arabic arabic">Ø§Ù„Ø·ÙÙ‘Ø§ÙˆÙÙ„ÙØ©Ù</td><td>La table</td><td class="vocab-arabic arabic">Ø¹ÙÙ„ÙÙ‰ Ø§Ù„Ø·ÙÙ‘Ø§ÙˆÙÙ„ÙØ©Ù</td></tr></tbody></table></div></div>` },
            { type: "exercise", content: `<div class="exercise-section"><h3 class="exercise-title">ğŸ¯ Exercice final</h3><div class="exercise-question"><p class="arabic" style="font-size:2rem;color:var(--primary);">Ø£ÙÙŠÙ’Ù†Ù Ø§Ù„ÙƒÙØªÙØ§Ø¨ÙØŸ</p><p>Le livre est sur le bureau. Quelle est la bonne rÃ©ponse ?</p></div><div class="options-grid"><button class="option-btn" data-correct="true" onclick="checkAnswer(this)"><span class="arabic">Ù‡ÙÙˆÙ Ø¹ÙÙ„ÙÙ‰ Ø§Ù„Ù…ÙÙƒÙ’ØªÙØ¨Ù</span></button><button class="option-btn" data-correct="false" onclick="checkAnswer(this)"><span class="arabic">Ù‡ÙÙˆÙ ÙÙÙŠ Ø§Ù„Ù…ÙÙƒÙ’ØªÙØ¨Ù</span></button><button class="option-btn" data-correct="false" onclick="checkAnswer(this)"><span class="arabic">Ù‡ÙÙˆÙ Ø¹ÙÙ„ÙÙ‰ Ø§Ù„Ù…ÙÙƒÙ’ØªÙØ¨Ù</span></button><button class="option-btn" data-correct="false" onclick="checkAnswer(this)"><span class="arabic">Ù‡ÙÙˆÙ Ù…ÙÙ†Ù Ø§Ù„Ù…ÙÙƒÙ’ØªÙØ¨Ù</span></button></div><div class="feedback-message" id="feedback"></div></div>` }
        ]
    },
    6: {
        title: "Ø§Ù„Ø¯Ø±Ø³ Ø§Ù„Ø³Ø§Ø¯Ø³ - Les noms propres (Ø§Ù„Ø¹ÙÙ„ÙÙ…Ù)",
        xp: 65,
        steps: [
            { type: "theory", content: `<div class="audio-hint"><span class="audio-hint-icon">ğŸ”Š</span><span>Clique sur les mots arabes pour entendre leur prononciation !</span></div><div class="theory-section"><h3 class="theory-title">ğŸ“š Les noms propres (Ø§Ù„Ø¹ÙÙ„ÙÙ…Ù)</h3><div class="theory-content"><div class="arabic-example"><div class="arabic-word arabic">Ø§Ù„Ø¹ÙÙ„ÙÙ…Ù</div><div class="arabic-translation">Le nom propre</div></div><p>Les noms propres en arabe dÃ©signent :</p><div class="grammar-box"><h4>ğŸ“ CaractÃ©ristiques des noms propres</h4><ul style="list-style:none;padding:0;"><li>â€¢ Une <strong>personne en particulier</strong> ou un <strong>lieu prÃ©cis</strong></li><li>â€¢ Toujours <strong>dÃ©fini</strong> (<span class="arabic">Ù…ÙØ¹Ù’Ø±ÙÙÙØ©ÙŒ</span>)</li><li>â€¢ Peut Ãªtre <strong>masculin ou fÃ©minin</strong> (<span class="arabic">Ù…ÙØ°ÙÙƒÙÙ‘Ø±ÙŒ ÙˆÙÙ…ÙØ¤ÙÙ†ÙÙ‘Ø«ÙŒ</span>)</li></ul></div><div class="arabic-example"><p class="arabic" style="font-size:1.5rem;">Ù‡ÙØ°ÙØ§ Ù…ÙØ­ÙÙ…ÙÙ‘Ø¯ÙŒ</p><p class="arabic-translation">Ceci est Mohammed</p><p class="arabic" style="font-size:1.5rem;margin-top:0.5rem;">ÙÙØ§Ø·ÙÙ…ÙØ©Ù ÙÙÙŠ Ø§Ù„Ù…ÙØ³Ù’Ø¬ÙØ¯Ù</p><p class="arabic-translation">Fatima est dans la mosquÃ©e</p></div></div></div>` },
            { type: "theory", content: `<div class="theory-section"><h3 class="theory-title">ğŸ“š Les types de noms dÃ©finis (Ø§Ù„Ù…ÙØ¹ÙØ§Ø±ÙÙÙ)</h3><div class="theory-content"><div class="grammar-box"><h4>ğŸ“ Les 3 types de noms dÃ©finis</h4><table class="vocab-table"><thead><tr><th>Type</th><th>Arabe</th><th>Exemple</th></tr></thead><tbody><tr><td>DÃ©fini par Ø§Ù„</td><td class="vocab-arabic arabic">Ø§Ù„Ù…ÙØ¹ÙØ±ÙÙ‘ÙÙ Ø¨ÙØ§Ù„</td><td class="vocab-arabic arabic">Ø§Ù„ÙƒÙØªÙØ§Ø¨Ù</td></tr><tr><td>Noms dÃ©monstratifs</td><td class="vocab-arabic arabic">Ø£ÙØ³Ù’Ù…ÙØ§Ø¡Ù Ø§Ù„Ø¥ÙØ´ÙØ§Ø±ÙØ©Ù</td><td class="vocab-arabic arabic">Ù‡ÙØ°ÙØ§ ØŒ Ø°ÙÙ„ÙÙƒÙ</td></tr><tr><td>Noms propres</td><td class="vocab-arabic arabic">Ø§Ù„Ø¹ÙÙ„ÙÙ…Ù</td><td class="vocab-arabic arabic">Ù…ÙØ­ÙÙ…ÙÙ‘Ø¯ÙŒ ØŒ Ù…ÙÙƒÙÙ‘Ø©Ù</td></tr></tbody></table></div></div></div>` },
            { type: "theory", content: `<div class="theory-section"><h3 class="theory-title">ğŸ“š Le tanwin (Ø§Ù„ØªÙÙ‘Ù†Ù’ÙˆÙÙŠÙ†Ù)</h3><div class="theory-content"><div class="arabic-example"><div class="arabic-word arabic">Ø§Ù„ØªÙÙ‘Ù†Ù’ÙˆÙÙŠÙ†Ù</div><div class="arabic-translation">Le tanwin</div></div><p>Le tanwin est un <strong>noun (Ù†) qui se prononce Ã  la fin du nom mais ne s'Ã©crit pas</strong>.</p><div class="grammar-box"><h4>ğŸ“ Exemples</h4><p class="arabic" style="font-size:1.5rem;text-align:center;">Ù…ÙØ­ÙÙ…ÙÙ‘Ø¯ÙŒ = Ù…ÙØ­ÙÙ…ÙÙ‘Ø¯ÙÙ†Ù’</p><p class="arabic" style="font-size:1.5rem;text-align:center;margin-top:0.5rem;">Ø²ÙÙŠÙ’Ø¯ÙŒ = Ø²ÙÙŠÙ’Ø¯ÙÙ†Ù’</p></div><div class="warning-box"><h4>âš ï¸ Exception importante</h4><p>Certains noms n'acceptent pas le tanwin : <span class="arabic" style="color:var(--accent);">Ù…ÙÙ…Ù’Ù†ÙÙˆØ¹ÙŒ Ù…ÙÙ†Ù Ø§Ù„ØµÙÙ‘Ø±Ù’ÙÙ</span></p><p>Notamment les <strong>noms propres fÃ©minins</strong> :</p><p class="arabic" style="font-size:1.3rem;text-align:center;margin-top:0.5rem;">Ø¹ÙØ§Ø¦ÙØ´ÙØ©Ù ØŒ Ø²ÙÙŠÙ’Ù†ÙØ¨Ù ØŒ ÙÙØ§Ø·ÙÙ…ÙØ©Ù ØŒ Ù…ÙÙƒÙÙ‘Ø©Ù</p></div></div></div>` },
            { type: "exercise", content: `<div class="exercise-section"><h3 class="exercise-title">ğŸ¯ Exercice pratique</h3><div class="exercise-question"><p>Quel nom propre prend le tanwin ?</p></div><div class="options-grid"><button class="option-btn" data-correct="true" onclick="checkAnswer(this)"><span class="arabic">Ù…ÙØ­ÙÙ…ÙÙ‘Ø¯ÙŒ</span></button><button class="option-btn" data-correct="false" onclick="checkAnswer(this)"><span class="arabic">ÙÙØ§Ø·ÙÙ…ÙØ©Ù</span></button><button class="option-btn" data-correct="false" onclick="checkAnswer(this)"><span class="arabic">Ø¹ÙØ§Ø¦ÙØ´ÙØ©Ù</span></button><button class="option-btn" data-correct="false" onclick="checkAnswer(this)"><span class="arabic">Ù…ÙÙƒÙÙ‘Ø©Ù</span></button></div><div class="feedback-message" id="feedback"></div></div>` },
            { type: "theory", content: `<div class="theory-section"><h3 class="theory-title">ğŸ“š Ù…ÙÙ†Ù’ Ø£ÙÙŠÙ’Ù†Ù ØŸ - D'oÃ¹ ?</h3><div class="theory-content"><div class="arabic-example"><div class="arabic-word arabic">Ù…ÙÙ†Ù’ Ø£ÙÙŠÙ’Ù†Ù Ø£ÙÙ†Ù’ØªÙ ØŸ</div><div class="arabic-translation">D'oÃ¹ viens-tu ?</div></div><p>La combinaison de <span class="arabic" style="color:var(--primary);">Ù…ÙÙ†Ù’</span> (prÃ©position "de") + <span class="arabic" style="color:var(--primary);">Ø£ÙÙŠÙ’Ù†Ù</span> (oÃ¹) permet de demander l'origine.</p><div class="grammar-box"><h4>ğŸ“ Exemples</h4><div class="arabic-example"><p class="arabic" style="font-size:1.3rem;">Ù…ÙÙ†Ù’ Ø£ÙÙŠÙ’Ù†Ù Ø£ÙÙ†Ù’ØªÙ ØµÙØ¯ÙÙŠÙ‚ÙÙŠ ØŸ Ø£ÙÙ†ÙØ§ Ù…ÙÙ†Ù’ ÙÙØ±ÙÙ†Ù’Ø³ÙØ§</p><p class="arabic-translation">D'oÃ¹ viens-tu mon ami ? Je viens de France</p><p class="arabic" style="font-size:1.3rem;margin-top:0.5rem;">Ù…ÙÙ†Ù’ Ø£ÙÙŠÙ’Ù†Ù Ù‚ÙÙ…ÙÙŠØµÙÙƒÙ ØŸ Ù‡ÙÙˆÙ Ù…ÙÙ†Ù’ Ù…ÙÙƒÙÙ‘Ø©Ù</p><p class="arabic-translation">D'oÃ¹ vient ta chemise ? Elle vient de La Mecque</p></div></div></div></div>` },
            { type: "theory", content: `<div class="theory-section"><h3 class="theory-title">ğŸ“š Vocabulaire : Pays et lieux</h3><div class="theory-content"><table class="vocab-table"><thead><tr><th>Arabe</th><th>FranÃ§ais</th></tr></thead><tbody><tr><td class="vocab-arabic arabic">ÙÙØ±ÙÙ†Ù’Ø³ÙØ§</td><td>La France</td></tr><tr><td class="vocab-arabic arabic">Ø§Ù„ÙŠÙØ§Ø¨ÙØ§Ù†Ù</td><td>Le Japon</td></tr><tr><td class="vocab-arabic arabic">Ø§Ù„ØµÙÙ‘ÙŠÙ†Ù</td><td>La Chine</td></tr><tr><td class="vocab-arabic arabic">Ø§Ù„Ù‡ÙÙ†Ù’Ø¯Ù</td><td>L'Inde</td></tr><tr><td class="vocab-arabic arabic">Ø¥ÙÙÙ’Ø±ÙÙŠÙ‚ÙÙŠÙØ§</td><td>L'Afrique</td></tr><tr><td class="vocab-arabic arabic">Ù…ÙØ¯Ù’Ø±ÙØ³ÙØ©ÙŒ</td><td>Ã‰cole</td></tr><tr><td class="vocab-arabic arabic">Ø¬ÙØ§Ù…ÙØ¹ÙØ©ÙŒ</td><td>UniversitÃ©</td></tr><tr><td class="vocab-arabic arabic">Ø³ÙÙˆÙ‚ÙŒ</td><td>MarchÃ©</td></tr></tbody></table></div></div>` },
            { type: "exercise", content: `<div class="exercise-section"><h3 class="exercise-title">ğŸ¯ Exercice final</h3><div class="exercise-question"><p class="arabic" style="font-size:2rem;color:var(--primary);">Ù…ÙÙ†Ù’ Ø£ÙÙŠÙ’Ù†Ù Ø£ÙÙ†Ù’ØªÙ ØŸ</p><p>Tu viens du Japon. Quelle est la bonne rÃ©ponse ?</p></div><div class="options-grid"><button class="option-btn" data-correct="true" onclick="checkAnswer(this)"><span class="arabic">Ø£ÙÙ†ÙØ§ Ù…ÙÙ†Ù Ø§Ù„ÙŠÙØ§Ø¨ÙØ§Ù†Ù</span></button><button class="option-btn" data-correct="false" onclick="checkAnswer(this)"><span class="arabic">Ø£ÙÙ†ÙØ§ ÙÙÙŠ Ø§Ù„ÙŠÙØ§Ø¨ÙØ§Ù†Ù</span></button><button class="option-btn" data-correct="false" onclick="checkAnswer(this)"><span class="arabic">Ø£ÙÙ†ÙØ§ Ø¥ÙÙ„ÙÙ‰ Ø§Ù„ÙŠÙØ§Ø¨ÙØ§Ù†Ù</span></button><button class="option-btn" data-correct="false" onclick="checkAnswer(this)"><span class="arabic">Ø£ÙÙ†ÙØ§ Ù…ÙÙ†Ù Ø§Ù„ÙŠÙØ§Ø¨ÙØ§Ù†Ù</span></button></div><div class="feedback-message" id="feedback"></div></div>` }
        ]
    },
    7: {
        title: "Ø§Ù„Ø¯Ø±Ø³ Ø§Ù„Ø³Ø§Ø¨Ø¹ - L'annexion approfondie (Ø§Ù„Ø¥ÙØ¶ÙØ§ÙÙØ©Ù)",
        xp: 80,
        steps: [
            { type: "theory", content: `<div class="audio-hint"><span class="audio-hint-icon">ğŸ”Š</span><span>Clique sur les mots arabes pour entendre leur prononciation !</span></div><div class="theory-section"><h3 class="theory-title">ğŸ“š RÃ©vision : Les 3 cas (Ø§Ù„Ø¥ÙØ¹Ù’Ø±ÙØ§Ø¨Ù)</h3><div class="theory-content"><div class="grammar-box"><h4>ğŸ“ Rappel des 3 dÃ©clinaisons</h4><table class="vocab-table"><thead><tr><th>Cas</th><th>Arabe</th><th>Marque</th><th>Nom dÃ©clinÃ©</th></tr></thead><tbody><tr><td style="color:var(--success);">Nominatif</td><td class="vocab-arabic arabic">Ø§Ù„Ø±ÙÙ‘ÙÙ’Ø¹Ù</td><td>Ù (Ø¶ÙÙ…ÙÙ‘Ø©)</td><td class="vocab-arabic arabic">Ù…ÙØ±Ù’ÙÙÙˆØ¹ÙŒ</td></tr><tr><td style="color:var(--warning);">Accusatif</td><td class="vocab-arabic arabic">Ø§Ù„Ù†ÙÙ‘ØµÙ’Ø¨Ù</td><td>Ù (ÙÙØªÙ’Ø­ÙØ©)</td><td class="vocab-arabic arabic">Ù…ÙÙ†Ù’ØµÙÙˆØ¨ÙŒ</td></tr><tr><td style="color:var(--accent);">GÃ©nitif</td><td class="vocab-arabic arabic">Ø§Ù„Ø¬ÙØ±ÙÙ‘</td><td>Ù (ÙƒÙØ³Ù’Ø±ÙØ©)</td><td class="vocab-arabic arabic">Ù…ÙØ¬Ù’Ø±ÙÙˆØ±ÙŒ</td></tr></tbody></table></div></div></div>` },
            { type: "theory", content: `<div class="theory-section"><h3 class="theory-title">ğŸ“š Le nominatif en pratique</h3><div class="theory-content"><div class="arabic-example"><div class="arabic-word arabic">Ø§Ù„Ø±ÙÙ‘ÙÙ’Ø¹Ù</div><div class="arabic-translation">C'est la base dans Ø§Ù„Ø¥ÙØ¹Ù’Ø±ÙØ§Ø¨</div></div><div class="grammar-box"><h4>ğŸ“ Quand utiliser le nominatif ?</h4><ul style="list-style:none;padding:0;"><li>â€¢ Pour le <strong>sujet</strong> de la phrase</li><li>â€¢ Pour le <strong>prÃ©dicat</strong> (Ø®Ø¨Ø±)</li><li>â€¢ Cas par dÃ©faut</li></ul></div><div class="arabic-example"><p class="arabic" style="font-size:1.8rem;">Ù‡ÙØ°ÙØ§ <span style="color:var(--success);">Ù…ÙØ­ÙÙ…ÙÙ‘Ø¯ÙŒ</span></p><p class="arabic-translation">Ceci est Mohammed</p><p style="margin-top:0.5rem;"><span class="arabic">Ù…ÙØ­ÙÙ…ÙÙ‘Ø¯ÙŒ</span> = <span style="color:var(--success);">Ø§ÙØ³Ù’Ù…ÙŒ Ù…ÙØ±Ù’ÙÙÙˆØ¹ÙŒ</span></p></div></div></div>` },
            { type: "exercise", content: `<div class="exercise-section"><h3 class="exercise-title">ğŸ¯ Exercice pratique</h3><div class="exercise-question"><p>Quelle est la marque du nominatif (Ø§Ù„Ø±ÙÙ‘ÙÙ’Ø¹Ù) ?</p></div><div class="options-grid"><button class="option-btn" data-correct="true" onclick="checkAnswer(this)"><span class="arabic">Ø§Ù„Ø¶ÙÙ‘Ù…ÙÙ‘Ø©Ù</span> (Ù)</button><button class="option-btn" data-correct="false" onclick="checkAnswer(this)"><span class="arabic">Ø§Ù„ÙÙØªÙ’Ø­ÙØ©Ù</span> (Ù)</button><button class="option-btn" data-correct="false" onclick="checkAnswer(this)"><span class="arabic">Ø§Ù„ÙƒÙØ³Ù’Ø±ÙØ©Ù</span> (Ù)</button><button class="option-btn" data-correct="false" onclick="checkAnswer(this)"><span class="arabic">Ø§Ù„Ø³ÙÙ‘ÙƒÙÙˆÙ†Ù</span> (Ù’)</button></div><div class="feedback-message" id="feedback"></div></div>` },
            { type: "theory", content: `<div class="theory-section"><h3 class="theory-title">ğŸ“š L'annexion dÃ©taillÃ©e (Ø§Ù„Ø¥ÙØ¶ÙØ§ÙÙØ©Ù)</h3><div class="theory-content"><div class="arabic-example"><div class="arabic-word arabic">Ø§Ù„Ø¥ÙØ¶ÙØ§ÙÙØ©Ù</div><div class="arabic-translation">L'annexion = exprimer la possession</div></div><p>L'annexion associe <strong>deux noms</strong> : le possÃ©dÃ© (Ù…ÙØ¶ÙØ§Ù) et le possesseur (Ù…ÙØ¶ÙØ§Ù Ø¥ÙÙ„ÙÙŠÙ’Ù‡Ù).</p><div class="warning-box"><h4>âš ï¸ RÃ¨gles essentielles</h4><ul style="list-style:none;padding:0;"><li>â€¢ <span class="arabic">Ø§Ù„Ù…ÙØ¶ÙØ§ÙÙ</span> : <strong>JAMAIS</strong> de Ø§Ù„ ni de tanwin</li><li>â€¢ <span class="arabic">Ø§Ù„Ù…ÙØ¶ÙØ§ÙÙ Ø¥ÙÙ„ÙÙŠÙ’Ù‡Ù</span> : <strong>TOUJOURS</strong> Ù…ÙØ¬Ù’Ø±ÙÙˆØ± (kasra)</li></ul></div></div></div>` },
            { type: "theory", content: `<div class="theory-section"><h3 class="theory-title">ğŸ“š Exemples pratiques</h3><div class="theory-content"><div class="arabic-example"><p class="arabic" style="font-size:1.8rem;"><span style="color:var(--primary);">ÙƒÙØªÙØ§Ø¨Ù</span> <span style="color:var(--accent);">Ù…ÙØ­ÙÙ…ÙÙ‘Ø¯Ù</span></p><p class="arabic-translation">Le livre de Mohammed</p><p style="font-size:0.9rem;">ÙƒÙØªÙØ§Ø¨Ù = Ù…ÙØ¶ÙØ§Ù (pas de Ø§Ù„, pas de tanwin)</p><p style="font-size:0.9rem;">Ù…ÙØ­ÙÙ…ÙÙ‘Ø¯Ù = Ù…ÙØ¶ÙØ§Ù Ø¥ÙÙ„ÙÙŠÙ’Ù‡Ù Ù…ÙØ¬Ù’Ø±ÙÙˆØ±</p></div><div class="arabic-example" style="margin-top:1rem;"><p class="arabic" style="font-size:1.8rem;"><span style="color:var(--primary);">Ø¨ÙÙŠÙ’ØªÙ</span> <span style="color:var(--accent);">Ø§Ù„Ù„Ù‡Ù</span></p><p class="arabic-translation">La maison d'Allah (la Ka'ba)</p></div><div class="arabic-example" style="margin-top:1rem;"><p class="arabic" style="font-size:1.8rem;"><span style="color:var(--primary);">Ø­ÙÙ‚ÙÙŠØ¨ÙØ©Ù</span> <span style="color:var(--accent);">Ø§Ù„Ù…ÙØ¯ÙØ±ÙÙ‘Ø³Ù</span></p><p class="arabic-translation">Le sac de l'enseignant</p></div></div></div>` },
            { type: "exercise", content: `<div class="exercise-section"><h3 class="exercise-title">ğŸ¯ Exercice pratique</h3><div class="exercise-question"><p>Comment forme-t-on "la maison de Zayd" ?</p></div><div class="options-grid"><button class="option-btn" data-correct="true" onclick="checkAnswer(this)"><span class="arabic">Ø¨ÙÙŠÙ’ØªÙ Ø²ÙÙŠÙ’Ø¯Ù</span></button><button class="option-btn" data-correct="false" onclick="checkAnswer(this)"><span class="arabic">Ø§Ù„Ø¨ÙÙŠÙ’ØªÙ Ø²ÙÙŠÙ’Ø¯Ù</span></button><button class="option-btn" data-correct="false" onclick="checkAnswer(this)"><span class="arabic">Ø¨ÙÙŠÙ’ØªÙŒ Ø²ÙÙŠÙ’Ø¯ÙŒ</span></button><button class="option-btn" data-correct="false" onclick="checkAnswer(this)"><span class="arabic">Ø¨ÙÙŠÙ’ØªÙ Ø²ÙÙŠÙ’Ø¯Ù</span></button></div><div class="feedback-message" id="feedback"></div></div>` },
            { type: "theory", content: `<div class="theory-section"><h3 class="theory-title">ğŸ“š Le Ù…ÙØ¶ÙØ§Ù varie selon la phrase</h3><div class="theory-content"><div class="grammar-box"><h4>ğŸ“ Position du Ù…ÙØ¶ÙØ§Ù</h4><p>Le <span class="arabic">Ù…ÙØ¶ÙØ§Ù</span> prend le cas que demande sa fonction :</p></div><div class="arabic-example"><p class="arabic" style="font-size:1.5rem;">Ù‡ÙØ°ÙØ§ <span style="color:var(--success);">ÙƒÙØªÙØ§Ø¨Ù</span> Ø§Ù„Ø·ÙÙ‘Ø§Ù„ÙØ¨Ù</p><p class="arabic-translation">Ceci est le livre de l'Ã©tudiant</p><p style="font-size:0.9rem;color:var(--success);">ÙƒÙØªÙØ§Ø¨Ù = Ù…ÙØ¶ÙØ§Ù Ù…ÙØ±Ù’ÙÙÙˆØ¹ (sujet)</p></div><div class="arabic-example" style="margin-top:1rem;"><p class="arabic" style="font-size:1.5rem;">Ø²ÙÙŠÙ’Ø¯ÙŒ ÙÙÙŠ <span style="color:var(--accent);">Ø¨ÙÙŠÙ’ØªÙ</span> ÙŠÙØ§Ø³ÙØ±Ù</p><p class="arabic-translation">Zayd est dans la maison de Yasser</p><p style="font-size:0.9rem;color:var(--accent);">Ø¨ÙÙŠÙ’ØªÙ = Ù…ÙØ¶ÙØ§Ù Ù…ÙØ¬Ù’Ø±ÙÙˆØ± (aprÃ¨s ÙÙŠ)</p></div></div></div>` },
            { type: "theory", content: `<div class="theory-section"><h3 class="theory-title">ğŸ“š Vocabulaire de l'annexion</h3><div class="theory-content"><table class="vocab-table"><thead><tr><th>Annexion</th><th>Traduction</th></tr></thead><tbody><tr><td class="vocab-arabic arabic">ÙƒÙØªÙØ§Ø¨Ù Ø§Ù„Ù„Ù‡Ù</td><td>Le Livre d'Allah (le Coran)</td></tr><tr><td class="vocab-arabic arabic">Ø±ÙØ³ÙÙˆÙ„Ù Ø§Ù„Ù„Ù‡Ù</td><td>Le Messager d'Allah</td></tr><tr><td class="vocab-arabic arabic">Ø¨ÙÙŠÙ’ØªÙ Ø§Ù„Ù…ÙØ¯ÙØ±ÙÙ‘Ø³Ù</td><td>La maison de l'enseignant</td></tr><tr><td class="vocab-arabic arabic">Ù‚ÙÙ„ÙÙ…Ù Ø§Ù„Ø·ÙÙ‘Ø§Ù„ÙØ¨Ù</td><td>Le stylo de l'Ã©tudiant</td></tr><tr><td class="vocab-arabic arabic">Ø§ÙØ¨Ù’Ù†Ù Ø¹ÙØ¨ÙÙ‘Ø§Ø³Ù</td><td>Le fils de Abbas (Ibn Abbas)</td></tr><tr><td class="vocab-arabic arabic">Ø¨ÙÙ†Ù’ØªÙ Ø­ÙØ§Ù…ÙØ¯Ù</td><td>La fille de Hamid</td></tr></tbody></table></div></div>` },
            { type: "exercise", content: `<div class="exercise-section"><h3 class="exercise-title">ğŸ¯ Exercice final</h3><div class="exercise-question"><p>Dans <span class="arabic" style="font-size:1.5rem;color:var(--primary);">Ø³ÙÙŠÙÙ‘Ø§Ø±ÙØ©Ù Ø§Ù„Ù…ÙØ¯ÙÙŠØ±Ù</span> (la voiture du directeur), quel est le cas de Ø§Ù„Ù…ÙØ¯ÙÙŠØ±Ù ?</p></div><div class="options-grid"><button class="option-btn" data-correct="false" onclick="checkAnswer(this)"><span class="arabic">Ù…ÙØ±Ù’ÙÙÙˆØ¹ÙŒ</span> car c'est le sujet</button><button class="option-btn" data-correct="false" onclick="checkAnswer(this)"><span class="arabic">Ù…ÙÙ†Ù’ØµÙÙˆØ¨ÙŒ</span> car c'est le COD</button><button class="option-btn" data-correct="true" onclick="checkAnswer(this)"><span class="arabic">Ù…ÙØ¬Ù’Ø±ÙÙˆØ±ÙŒ</span> car c'est Ù…ÙØ¶ÙØ§Ù Ø¥ÙÙ„ÙÙŠÙ’Ù‡Ù</button><button class="option-btn" data-correct="false" onclick="checkAnswer(this)">Aucun cas particulier</button></div><div class="feedback-message" id="feedback"></div></div>` }
        ]
    }
};

// Functions
function updateXPDisplay() {
    document.getElementById('totalXP').textContent = totalXP + ' XP';
}

function updateProgressBars() {
    const totalLessons = Object.keys(lessonsData).length;
    const completedLessons = Object.keys(lessonsProgress).filter(k => lessonsProgress[k] === 100).length;
    const globalPercentage = (completedLessons / totalLessons) * 100;
    document.getElementById('globalProgress').style.width = globalPercentage + '%';
    
    for (let i = 1; i <= totalLessons; i++) {
        const el = document.getElementById('lesson' + i + 'Progress');
        if (el) el.style.width = (lessonsProgress[i] || 0) + '%';
    }
}

function startLesson(lessonNum) {
    currentLesson = lessonNum;
    currentStep = 0;
    const lesson = lessonsData[lessonNum];
    document.getElementById('lessonTitle').textContent = lesson.title;
    document.getElementById('lessonsGrid').style.display = 'none';
    document.getElementById('learningContainer').classList.add('active');
    renderStepIndicator();
    renderStep();
}

function renderStepIndicator() {
    const container = document.getElementById('stepIndicator');
    const steps = lessonsData[currentLesson].steps;
    container.innerHTML = steps.map((_, i) => 
        `<div class="step-dot ${i === currentStep ? 'active' : ''} ${i < currentStep ? 'completed' : ''}"></div>`
    ).join('');
}

function renderStep() {
    const step = lessonsData[currentLesson].steps[currentStep];
    document.getElementById('lessonContent').innerHTML = step.content;
    makeSpeakable(document.getElementById('lessonContent'));
    renderStepIndicator();
    document.getElementById('prevBtn').disabled = currentStep === 0;
    const isLast = currentStep === lessonsData[currentLesson].steps.length - 1;
    document.getElementById('nextBtn').textContent = isLast ? 'Terminer âœ“' : 'Suivant â†’';
}

function nextStep() {
    const steps = lessonsData[currentLesson].steps;
    if (currentStep < steps.length - 1) {
        currentStep++;
        renderStep();
    } else {
        completeLesson();
    }
}

function prevStep() {
    if (currentStep > 0) {
        currentStep--;
        renderStep();
    }
}

function checkAnswer(btn) {
    const isCorrect = btn.dataset.correct === 'true';
    const feedback = document.getElementById('feedback');
    const allBtns = btn.parentElement.querySelectorAll('.option-btn');
    
    allBtns.forEach(b => b.style.pointerEvents = 'none');
    
    if (isCorrect) {
        btn.classList.add('correct');
        feedback.textContent = 'âœ… Excellent ! Bonne rÃ©ponse !';
        feedback.className = 'feedback-message show success';
    } else {
        btn.classList.add('incorrect');
        allBtns.forEach(b => { if (b.dataset.correct === 'true') b.classList.add('correct'); });
        feedback.textContent = 'âŒ Pas tout Ã  fait. Regarde la bonne rÃ©ponse.';
        feedback.className = 'feedback-message show error';
    }
}

function completeLesson() {
    const lesson = lessonsData[currentLesson];
    if (!lessonsProgress[currentLesson] || lessonsProgress[currentLesson] < 100) {
        totalXP += lesson.xp;
        lessonsProgress[currentLesson] = 100;
        localStorage.setItem('arabicXP', totalXP);
        localStorage.setItem('lessonsProgress', JSON.stringify(lessonsProgress));
    }
    document.getElementById('modalXP').textContent = '+' + lesson.xp + ' XP';
    document.getElementById('completionModal').classList.add('show');
    updateXPDisplay();
    updateProgressBars();
}

function closeModal() {
    document.getElementById('completionModal').classList.remove('show');
    closeLesson();
}

function closeLesson() {
    document.getElementById('learningContainer').classList.remove('active');
    document.getElementById('lessonsGrid').style.display = 'grid';
    currentLesson = null;
    currentStep = 0;
}